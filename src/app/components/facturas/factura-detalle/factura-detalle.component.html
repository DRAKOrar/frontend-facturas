<div class="container mt-4">
  <h2 class="text-center mb-3">Gestión de Facturas</h2>

  <!-- Filtro -->
  <div class="mb-3">
    <input type="text" [(ngModel)]="filtro" (input)="filtrar()" placeholder="Buscar por nombre, cédula o ID"
      class="form-control form-control-lg" />
  </div>

  <!-- Errores -->
  <div *ngIf="errorMessage" class="alert alert-danger">
    {{ errorMessage }}
  </div>

  <!-- Cargando -->
  <div *ngIf="cargando" class="text-center">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
  </div>

  <!-- Tabla -->
  <div *ngIf="facturasFiltradas.length > 0" class="table-responsive">
    <table class="table table-striped table-hover table-bordered">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Cliente</th>
          <th>Fecha</th>
          <th>Total</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let factura of facturasFiltradas">
          <td>{{ factura.id }}</td>
          <td>{{ factura.cliente?.nombre }} ({{ factura.cliente?.cedula }})</td>
          <td>{{ factura.fechaCreacion | date:'dd/MM/yyyy' }}</td>
          <td>{{ factura.total | currency:'COP':'symbol-narrow':'1.0-0' }}</td>
          <td>
            <span class="badge" [ngClass]="{
              'bg-success': factura.estado === 'ACTIVA',
              'bg-danger': factura.estado === 'INACTIVA'
            }">
              {{ factura.estado === 'INACTIVA' ? 'CANCELADA' : factura.estado }}
            </span>
          </td>
          <td>
            <button class="btn btn-sm btn-info me-1" (click)="abrirModalDetalle(factura)" title="Ver detalles">
  <i class="fas fa-eye"></i>
</button>

            <button class="btn btn-sm btn-warning me-1" (click)="abrirModalEditar(factura)" title="Editar">
              <i class="fas fa-edit"></i>
            </button>

            <button class="btn btn-sm btn-danger" (click)="eliminarFactura(factura.id!)" title="Eliminar">
              <i class="fas fa-trash-alt"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Sin resultados -->
  <div *ngIf="!cargando && facturasFiltradas.length === 0">
    <p class="text-center">No se encontraron facturas.</p>
  </div>
</div>
<app-editar-factura-modal *ngIf="modalEditarVisible" [factura]="facturaSeleccionada" (cerrar)="cerrarModalEditar()"
  (actualizada)="refrescarFacturas()">
</app-editar-factura-modal>
<app-factura-detalle-modal
  *ngIf="modalDetalleVisible"
  [factura]="facturaParaVer"
  (cerrar)="cerrarModalDetalle()">
</app-factura-detalle-modal>
